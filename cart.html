<!DOCTYPE html>
<html lang="ru">
<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <title>Корзина - BADDvisor</title>
    <link href="https://cdn.jsdelivr.net/npm/bootstrap@5.3.0/dist/css/bootstrap.min.css" rel="stylesheet">
    <link rel="stylesheet" href="https://cdn.jsdelivr.net/npm/bootstrap-icons@1.10.0/font/bootstrap-icons.css">
    <link rel="stylesheet" href="css/style.css">
    <style>
        body { padding-top: 80px; }
        .cart-header { background: #f8f9fa; padding: 40px 0; margin-bottom: 30px; }
        .empty-cart { min-height: 400px; display: flex; align-items: center; justify-content: center; }
        .quantity-input { width: 70px; text-align: center; }
    </style>
</head>
<body>
    <!-- Навигация -->
    <nav class="navbar navbar-expand-lg navbar-light bg-white fixed-top shadow-sm">
        <div class="container">
            <a class="navbar-brand fw-bold text-primary" href="index.html">
                <i class="bi bi-capsule me-2"></i>BADDvisor
            </a>
            <div class="collapse navbar-collapse" id="navbarNav">
                <ul class="navbar-nav ms-auto">
                    <li class="nav-item">
                        <a class="nav-link" href="index.html">Главная</a>
                    </li>
                    <li class="nav-item">
                        <a class="nav-link" href="catalog.html">Каталог</a>
                    </li>
                    <li class="nav-item">
                        <a class="nav-link" href="assistant.html">ИИ-ассистент</a>
                    </li>
                    <li class="nav-item">
                        <a class="nav-link active position-relative" href="cart.html">
                            <i class="bi bi-cart3"></i> Корзина
                            <span id="cartCounter" class="position-absolute top-0 start-100 translate-middle badge rounded-pill bg-danger">0</span>
                        </a>
                    </li>
                </ul>
            </div>
        </div>
    </nav>

    <!-- Шапка корзины -->
    <div class="cart-header">
        <div class="container">
            <div class="row align-items-center">
                <div class="col-md-8">
                    <h1 class="display-5 fw-bold mb-3">Ваша корзина</h1>
                    <p class="lead text-muted">Оформите заказ или продолжайте покупки</p>
                </div>
                <div class="col-md-4 text-md-end">
                    <div class="d-inline-block bg-white p-3 rounded shadow-sm">
                        <div class="d-flex align-items-center">
                            <i class="bi bi-cart-check text-primary fs-4 me-3"></i>
                            <div>
                                <div class="fw-bold fs-5" id="totalItems">0</div>
                                <div class="text-muted small">товаров</div>
                            </div>
                        </div>
                    </div>
                </div>
            </div>
        </div>
    </div>

    <!-- Содержимое корзины -->
    <div class="container">
        <div id="cartContainer">
            <!-- Корзина загружается через JS -->
        </div>
        
        <!-- Пустая корзина -->
        <div id="emptyCart" class="empty-cart text-center" style="display: none;">
            <div>
                <div class="display-1 text-muted mb-4">
                    <i class="bi bi-cart-x"></i>
                </div>
                <h3 class="mb-3">Ваша корзина пуста</h3>
                <p class="text-muted mb-4">Добавьте товары из каталога, чтобы сделать заказ</p>
                <a href="catalog.html" class="btn btn-primary btn-lg">
                    <i class="bi bi-arrow-right me-2"></i>Перейти в каталог
                </a>
            </div>
        </div>
    </div>

    <!-- Футер -->
    <footer class="bg-dark text-white py-4 mt-5">
        <div class="container text-center">
            <p class="mb-0">
                <small>© 2024 Демо-проект BADDvisor. Все данные вымышлены.</small>
            </p>
        </div>
    </footer>

    <!-- Скрипты -->
    <script src="https://cdn.jsdelivr.net/npm/bootstrap@5.3.0/dist/js/bootstrap.bundle.min.js"></script>
    <script src="js/products.js"></script>
    <script src="js/cart.js"></script>
    <script>
        // Загрузка корзины
        document.addEventListener('DOMContentLoaded', function() {
            updateCartCounter();
            loadCart();
        });

        function updateCartCounter() {
            if (window.cart && cart.updateCounter) {
                cart.updateCounter();
            }
        }

        function loadCart() {
            const cartItems = cart.getAll();
            const products = Products.getAll();
            
            // Обновляем счетчик товаров
            document.getElementById('totalItems').textContent = cart.getCount();
            
            if (cartItems.length === 0) {
                document.getElementById('cartContainer').style.display = 'none';
                document.getElementById('emptyCart').style.display = 'flex';
                return;
            }
            
            document.getElementById('cartContainer').style.display = 'block';
            document.getElementById('emptyCart').style.display = 'none';
            
            let total = 0;
            let html = `
                <div class="row">
                    <div class="col-lg-8">
                        <div class="card border-0 shadow-sm mb-4">
                            <div class="card-body">
                                <h4 class="card-title mb-4">
                                    <i class="bi bi-bag-check me-2"></i>Товары в корзине
                                </h4>
            `;
            
            // Товары
            cartItems.forEach(item => {
                const product = products.find(p => p.id === item.id);
                if (!product) return;
                
                const itemTotal = product.price * item.quantity;
                total += itemTotal;
                
                html += `
                    <div class="cart-item mb-4 pb-4 border-bottom">
                        <div class="row align-items-center">
                            <div class="col-md-2 col-4">
                                <a href="product-details.html?id=${product.id}">
                                    <img src="${product.image}" 
                                         class="img-fluid rounded" 
                                         alt="${product.name}"
                                         style="height: 80px; width: 80px; object-fit: cover;">
                                </a>
                            </div>
                            <div class="col-md-4 col-8">
                                <h6 class="mb-1">
                                    <a href="product-details.html?id=${product.id}" class="text-decoration-none text-dark">
                                        ${product.name}
                                    </a>
                                </h6>
                                <p class="text-muted small mb-0">${product.description}</p>
                            </div>
                            <div class="col-md-3 col-6 mt-3 mt-md-0">
                                <div class="input-group">
                                    <button class="btn btn-outline-secondary" 
                                            type="button"
                                            onclick="updateQuantity(${product.id}, ${item.quantity - 1})">
                                        <i class="bi bi-dash"></i>
                                    </button>
                                    <input type="text" 
                                           class="form-control text-center quantity-input" 
                                           value="${item.quantity}"
                                           readonly>
                                    <button class="btn btn-outline-secondary" 
                                            type="button"
                                            onclick="updateQuantity(${product.id}, ${item.quantity + 1})">
                                        <i class="bi bi-plus"></i>
                                    </button>
                                </div>
                            </div>
                            <div class="col-md-2 col-3 mt-3 mt-md-0 text-center">
                                <span class="fw-bold">${product.price} ₽</span>
                            </div>
                            <div class="col-md-1 col-3 mt-3 mt-md-0 text-center">
                                <button class="btn btn-outline-danger btn-sm" 
                                        onclick="removeFromCart(${product.id})">
                                    <i class="bi bi-trash"></i>
                                </button>
                            </div>
                        </div>
                        <div class="row mt-2">
                            <div class="col-12 text-end">
                                <span class="text-muted">Сумма: </span>
                                <span class="fw-bold">${itemTotal} ₽</span>
                            </div>
                        </div>
                    </div>
                `;
            });
            
            html += `
                            </div>
                        </div>
                    </div>
                    
                    <div class="col-lg-4">
                        <div class="card border-0 shadow-sm sticky-top" style="top: 100px;">
                            <div class="card-body">
                                <h4 class="card-title mb-4">
                                    <i class="bi bi-receipt me-2"></i>Итог заказа
                                </h4>
                                
                                <div class="mb-3">
                                    <div class="d-flex justify-content-between mb-2">
                                        <span class="text-muted">Товары (${cart.getCount()})</span>
                                        <span>${total} ₽</span>
                                    </div>
                                    <div class="d-flex justify-content-between mb-2">
                                        <span class="text-muted">Доставка</span>
                                        <span>0 ₽</span>
                                    </div>
                                    <div class="d-flex justify-content-between mb-3">
                                        <span class="text-muted">Скидка</span>
                                        <span class="text-success">0 ₽</span>
                                    </div>
                                    <hr>
                                    <div class="d-flex justify-content-between">
                                        <span class="fw-bold">Итого</span>
                                        <span class="fw-bold fs-5">${total} ₽</span>
                                    </div>
                                </div>
                                
                                <div class="alert alert-info small">
                                    <i class="bi bi-info-circle me-2"></i>
                                    Бесплатная доставка при заказе от 3000 ₽
                                </div>
                                
                                <button class="btn btn-primary w-100 btn-lg mb-3" onclick="checkout()">
                                    <i class="bi bi-lock me-2"></i>Перейти к оформлению
                                </button>
                                
                                <button class="btn btn-outline-danger w-100" onclick="clearCart()">
                                    <i class="bi bi-trash me-2"></i>Очистить корзину
                                </button>
                                
                                <div class="text-center mt-4">
                                    <a href="catalog.html" class="text-decoration-none">
                                        <i class="bi bi-arrow-left me-2"></i>Продолжить покупки
                                    </a>
                                </div>
                            </div>
                        </div>
                    </div>
                </div>
                
                <!-- Важное предупреждение -->
                <div class="alert alert-warning mt-4">
                    <div class="d-flex">
                        <i class="bi bi-exclamation-triangle me-3"></i>
                        <div>
                            <h5 class="alert-heading">Демо-проект</h5>
                            <p class="mb-0">Оформление заказа не доступно в демо-версии. Это только демонстрация функционала корзины.</p>
                        </div>
                    </div>
                </div>
            `;
            
            document.getElementById('cartContainer').innerHTML = html;
        }

        function updateQuantity(productId, newQuantity) {
            if (newQuantity <= 0) {
                removeFromCart(productId);
            } else {
                cart.update(productId, newQuantity);
                loadCart();
                updateCartCounter();
            }
        }

        function removeFromCart(productId) {
            if (confirm('Удалить товар из корзины?')) {
                cart.remove(productId);
                loadCart();
                updateCartCounter();
                cart.showNotification('Товар удален из корзины', 'info');
            }
        }

        function clearCart() {
            if (confirm('Очистить всю корзину?')) {
                cart.clear();
                loadCart();
                updateCartCounter();
                cart.showNotification('Корзина очищена', 'info');
            }
        }

        function checkout() {
            cart.showNotification('Оформление заказа доступно в полной версии проекта', 'info');
        }
    </script>
</body>
</html>